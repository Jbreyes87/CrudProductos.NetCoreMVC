
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .td {
        width: 200px;
    }
</style>
<div class="d-flex mb-2">
    <div class="p-2 ">
        <h3>
            Lista de Articulos
        </h3>
    </div>

    <div class="ml-auto p-2 ">
        <a class="btn btn-primary" asp-action="Create"><i class='bx bxs-plus-square'></i>&nbsp Nuevo Articulo</a>
    </div>
</div>



<div class="card">
    <div class="card-body">
        <table id="tblArticulos" class="table table-striped table-bordered table-sm " style="width:100%">
            <thead class="table-dark">
                <tr>
                    <th>Id</th>
                    <th>Nombre</th>
                    <th>Descripcion</th>
                    <th>Fecha</th>
                    <th>Categoria</th>
                    <th></th>
                </tr>
            </thead>

        </table>
    </div>
</div>


@section scripts {
    <script>
        var dataTable;

        $(document).ready(function () {
            cargarDatatable();

        });


        function cargarDatatable() {
            debugger;
            dataTable = $("#tblArticulos").DataTable({
                "ajax": {
                    "url": "Articulos/GetList",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [
                    { "data": "id", "width": "5%" },
                    { "data": "nombre", "width": "15%" },
                    { "data": "descripcion", "width": "20%" },
                    { "data": "fechaCreacion", "width": "20%" },
                    { "data": "nombreCategoria", "width": "15%" },
                    {
                        "data": "id",
                        "render": function (data) {
                            return `<div class="text-center">
                                <a href='/Articulos/Edit/${data}' class='btn btn-primary text-white'  width:30px;'>
                                <i class='bx bxs-edit'></i>
                                </a>
                                &nbsp;
                                <a onclick=Delete("/Articulos/Delete/${data}") class='btn btn-danger text-white'  width:50px;'>
                                <i class='bx bxs-trash'></i>
                                </a>
                                `;
                        }, "width": "10%"
                    }
                ],
                "language": {
                    "emptyTable": "No hay registros"
                },
                "width": "100%"
            });
        }

        function Delete(url) {

            Swal.fire({
                title: 'Esta seguro de eliminar este registro?',
                text: "este contenido no se podra recuperar!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, Eliminar!'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: 'DELETE',
                        url: url,
                        success: function (Response) {
                            var JsonString = JSON.stringify(Response);
                            var objetoJosn = JSON.parse(JsonString);

                            if (objetoJosn.isSuccess) {
                                toastr.success(objetoJosn.mensaje);
                                dataTable.ajax.reload();

                            }
                            else {
                                toastr.error(objetoJosn.mensaje);


                            }
                        }
                    });


                } else {

                }
            })

        }




    </script>

}
